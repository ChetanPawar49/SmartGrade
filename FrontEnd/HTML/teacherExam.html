<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/teacherExam.css">
    <title>Teacher's Exam Creation</title>
</head>
<body>
    <div class="container">
        <div class="section">
            <h2>Create Exam Questions</h2>
            <label for="num-questions">How many questions do you want to create?</label>
            <input type="number" id="num-questions" min="1" placeholder="Enter number of questions">
            <label for="exam-time">Set Exam Duration (HH:MM)</label>
            <input type="time" id="exam-time" placeholder="Set exam time">
            <button onclick="generateQuestionInputs()">Generate Questions</button>
        </div>
        <div id="questions-form" class="questions-form-container"></div>
        <div id="created-questions" class="created-questions"></div>
        <div id="submit-container" class="buttons hidden">
            <button onclick="submitQuestions()">Submit All Questions</button>
        </div>
        <div id="alert-message" class="alert hidden"></div>
        <div id="success-message" class="success hidden"></div>

        <div id="exam-preview" class="exam-preview hidden">
            <h2>Exam Preview</h2>
            <div id="exam-questions"></div>
            <div id="exam-time-display"></div>
        </div>
    </div>
    <script>
        let questionCount = 0;
        const questionsArray = [];

        function generateQuestionInputs() {
            const numQuestions = parseInt(document.getElementById('num-questions').value);
            const examTime = document.getElementById('exam-time').value;

            if (isNaN(numQuestions) || numQuestions <= 0) {
                alert("Please enter a valid number of questions.");
                return;
            }

            if (!examTime) {
                alert("Please set a valid exam duration.");
                return;
            }

            questionCount = numQuestions;
            const formContainer = document.getElementById('questions-form');
            formContainer.innerHTML = '';

            for (let i = 0; i < numQuestions; i++) {
                formContainer.innerHTML += `
                    <div class="question-box">
                        <h3>Question ${i + 1}</h3>
                        <input type="text" id="question-${i}" placeholder="Enter question text">
                        <div class="options-container" id="options-${i}">
                            <div class="option">
                                <input type="radio" name="answer-${i}" value="0">
                                <input type="text" placeholder="Option 1">
                            </div>
                            <div class="option">
                                <input type="radio" name="answer-${i}" value="1">
                                <input type="text" placeholder="Option 2">
                            </div>
                            <div class="option">
                                <input type="radio" name="answer-${i}" value="2">
                                <input type="text" placeholder="Option 3">
                            </div>
                            <div class="option">
                                <input type="radio" name="answer-${i}" value="3">
                                <input type="text" placeholder="Option 4">
                            </div>
                        </div>
                    </div>
                `;
            }

            document.getElementById('submit-container').classList.remove('hidden');
            document.getElementById('alert-message').classList.add('hidden');
            document.getElementById('success-message').classList.add('hidden');
            document.getElementById('exam-preview').classList.add('hidden'); // Hide exam preview initially
        }

        function submitQuestions() {
            questionsArray.length = 0;
            const formElements = document.querySelectorAll('.question-box');

            let isValid = true;
            formElements.forEach((box, index) => {
                const questionText = box.querySelector(`input[id="question-${index}"]`).value;
                const options = Array.from(box.querySelectorAll('.options-container .option input[type="text"]')).map(input => input.value);
                const correctAnswer = box.querySelector(`input[name="answer-${index}"]:checked`)?.value;

                if (questionText && options.length === 4 && correctAnswer !== undefined) {
                    questionsArray.push({ question: questionText, options, answer: parseInt(correctAnswer) });
                } else {
                    isValid = false;
                }
            });

            if (isValid) {
                const createdQuestionsContainer = document.getElementById('created-questions');
                createdQuestionsContainer.innerHTML = '';
                const examPreviewContainer = document.getElementById('exam-questions');
                examPreviewContainer.innerHTML = '';

                questionsArray.forEach((question, index) => {
                    createdQuestionsContainer.innerHTML += `
                        <div class="question-item">
                            <span>${index + 1}</span>
                            <p>${question.question}</p>
                        </div>
                    `;
                    examPreviewContainer.innerHTML += `
                        <div class="question-item">
                            <span>${index + 1}</span>
                            <p>${question.question}</p>
                            <div class="options-container">
                                ${question.options.map((option, idx) => `
                                    <div class="option">
                                        <input type="radio" name="exam-answer-${index}" value="${idx}">
                                        <span>${option}</span>
                                    </div>`).join('')}
                            </div>
                        </div>
                    `;
                });

                const examTime = document.getElementById('exam-time').value;
                document.getElementById('exam-time-display').innerHTML = `<strong>Time Allotted: ${examTime}</strong>`;
                document.getElementById('exam-preview').classList.remove('hidden');

                document.getElementById('alert-message').classList.add('hidden');
                document.getElementById('success-message').textContent = 'Test created successfully!';
                document.getElementById('success-message').classList.remove('hidden');
            } else {
                document.getElementById('alert-message').textContent = 'Please complete all questions with exactly four options before submitting.';
                document.getElementById('alert-message').classList.remove('hidden');
                document.getElementById('success-message').classList.add('hidden');
            }
        }
    </script>
</body>
</html>